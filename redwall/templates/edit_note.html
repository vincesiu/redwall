<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title> {{ "Redwall - {}".format(title) }} </title>
</head>
<body>

<div id="input_container" style="width: 100%; min-height: 500px;">
    <form style="width:auto;height: 500px;" id="input_form"> {#  action="/meow"> #}
        <p id="input_title">{{title}}</p>
        <p id="input_note_id">{{note_id}}</p>
        <textarea type="text" style="width: 100%;height: 80%;" id="input_content">{{ unrendered_content }}</textarea>
        <input type="submit" id="input_submit">
    </form>  
</div>

<div id="output_container">
    {# The safe filter is used to render html without escape codes #}
    {{rendered_content | safe}}
</div>

<script>
function updateNote(event)  {
    fetch('./update_note', {
        method:'post',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            'title': document.getElementById('input_title').innerHTML,
            'content': document.getElementById('input_content').value,
            'note_id': document.getElementById('input_note_id').innerHTML
        })
    }).then(function(response) {
      console.log('Successfully updated note id:', document.getElementById('input_note_id').innertHTML);
    })
};

function renderMarkdown(event) {
  fetch('./render_markdown', {
    method: 'post',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({content: event.target.value})
  }).then(function(response) {
      console.log('Markdown rendered to html: ', response);
    return response.json();
  }).then(function(data) {
      document.getElementById('output_container').innerHTML = data;
  });
};

document.getElementById('input_form').addEventListener('submit', updateNote);
document.getElementById('input_content').addEventListener('change', renderMarkdown);
</script>

</body>
